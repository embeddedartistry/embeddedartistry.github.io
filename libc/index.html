<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded Artistry libc: Embedded Artistry libc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded Artistry libc
   </div>
   <div id="projectbrief">C Standard Library Support for Bare-metal Systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Embedded Artistry libc </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Embedded Artistry's <code>libc</code> is a stripped-down C standard library implementation targeted for microcontroller-based embedded systems.</p>
<p>In order to conserve precious memory resources, this library does not supply the complete C standard library implementation. Instead, a subset of functions which are useful on bare-metal embedded systems has been selected. If you have a bare metal or RTOS-based embedded system, this library is for you!</p>
<p>Unlike many other C libraries that I've come across, this library implements unit tests and has addressed long-standing flaws in open-source implementations of the C standard library functions. We're continually adding tests and making additional improvements over the baseline implementations.</p>
<p><code>malloc</code> and <code>free</code> are not included in this library. If you need dynamic memory allocation support, you will need to couple this library with something like <a href="https://github.com/embeddedartistry/libmemory">Embedded Artistry's <code>libmemory</code></a>, which contains implementations of <code>malloc</code> and <code>free</code>.</p>
<p>If you are interested in contributing to this project, please read the <a class="el" href="d5/d69/md_docs__c_o_n_t_r_i_b_u_t_i_n_g.html">`CONTRIBUTING` guide</a>.</p>
<h2>Table of Contents</h2>
<ol type="1">
<li><a href="#about-the-project">About the Project</a></li>
<li><a href="#project-status">Project Status</a></li>
<li><a href="#getting-started">Getting Started</a><ol type="a">
<li><a href="#requirements">Requirements</a><ol type="i">
<li><a href="#meson-build-system">Meson Build System</a></li>
</ol>
</li>
<li><a href="#getting-the-source">Getting the Source</a></li>
<li><a href="#building">Building</a><ol type="i">
<li><a href="#cross-compiling">Cross-compiling</a></li>
</ol>
</li>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a><ol type="i">
<li><a href="#aligned-malloc">Aligned Malloc</a></li>
</ol>
</li>
<li><a href="#testing">Testing</a></li>
</ol>
</li>
<li><a href="#configuration-options">Configuration Options</a></li>
</ol>
<ol type="1">
<li><a href="#formatting">Formatting</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#need-help">Need Help?</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#further-reading">Futher Reading</a></li>
<li><a href="#authors">Authors</a></li>
<li><a href="#license">License</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
</ol>
<h2>About the Project</h2>
<p>Embedded Artistry's <code>libc</code> is intended to provide a portable set of useful C standard library functions that allows quick bring-up of new bare-metal and RTOS-based embedded systems.</p>
<p>Additionally, we want to provide a high-quality <code>libc</code> implementation by ensuring that each function has unit test coverage and addresses flaws exposed by the static analyzer. Many C library function implementations remain untested and contain errors. We are fighting back against poor implementations.</p>
<p>In order to conserve memory, this library does not supply the complete C standard library functionality. Instead, a subset of functions which are useful on bare-metal embedded systems has been selected. This selection has primarily been driven by my own experience in microcontroller-focused development. If you need additional features, please file an issue and make a feature request.</p>
<p>The functional implementations in this library have been selected for portability and quick bring-up of new systems. There may be more efficient implementations for these functions, but often they are architecture specific implementations. If you have suggestions for improving performance, we are always happy to hear them.</p>
<p><code>malloc</code> and <code>free</code> are not included in this library. Because memory allocation schemes vary greatly with embedded systems (some not even allowing dynamic memory), you will need to supply your own implementations based on your system's needs. You can couple this library with the <a href="https://github.com/embeddedartistry/libmemory">Embedded Artistry <code>libmemory</code></a>, which contains implementations of <code>malloc</code> and <code>free</code>.</p>
<h2>Project Status</h2>
<p>This library provides a complete-enough implementation to compile and link clang's <code>libc++</code> and <code>libc++abi</code> (see <a href="https://github.com/embeddedartistry/libcpp">Embedded Artistry's libcpp project</a>). In order to achieve this, some functions are only defined in the headers but do not have an implementation. Unsupported-but-defined functions can be removed using a build option (<code>hide-unimplemented-libc-apis</code>).</p>
<p>The following portions of the C library have been implemented:</p>
<ul>
<li><code>assert</code></li>
<li>Basic C runtime support (<code><a class="el" href="d7/d39/crt_8c.html">crt.c</a></code>, <code>exit</code>, <code>atexit</code>, etc.)</li>
<li>ctype</li>
<li>math (via <a href="https://github.com/JuliaMath/openlibm">openlibm</a>)</li>
<li>string functions</li>
<li>stdlib<ul>
<li><code>atoX</code></li>
<li><code>abs</code>, <code>labs</code>, <code>llabs</code></li>
<li><code>bsearch</code></li>
<li><code>calloc</code></li>
<li><code>div</code>, <code>ldiv</code>, <code>lldiv</code></li>
<li><code>heapsort</code>, <code>heapsort_r</code></li>
<li><code>imaxabs</code>, <code>imaxdiv</code></li>
<li><code>qsort</code>, <code>qsort_r</code></li>
<li><code>rand</code> family</li>
<li><code>realloc</code></li>
<li><code>strtoX</code> functions (many via <a href="https://github.com/embeddedartistry/gdtoa"><code>gdtoa</code></a>)</li>
</ul>
</li>
<li>Basic stdio<ul>
<li><code>printf</code> family (most via <a href="https://github.com/mpaland/printf"><code>mpaland/printf</code></a>)</li>
<li><code>putchar</code></li>
<li><code>puts</code></li>
</ul>
</li>
<li><code>time</code> types and <code><a class="el" href="de/df7/time_8h.html#aa7246eaa46fb0ec62b872808f3720d8c">asctime()</a></code></li>
<li><code>wchar</code> type definitions and <code>wctype</code> functions</li>
</ul>
<p>The following architectures are currently supported:</p>
<ul>
<li>x86</li>
<li>x86_64</li>
<li>ARM</li>
<li>ARM64</li>
</ul>
<p>The following unit tests need to be added:</p>
<ul>
<li><code>bsearch</code></li>
<li><code>imaxdiv</code></li>
<li><code>div</code>, <code>ldiv</code></li>
<li><code>realloc</code></li>
<li><code>rand</code> family</li>
<li><code>strnstr</code></li>
<li><code>memmove</code></li>
</ul>
<p>These are not implemented by may be added in the future:</p>
<ul>
<li><code>wchar</code> functions</li>
<li><code>errno</code> support (enabled as a compile-time switch)</li>
<li><code>getopt</code> support</li>
<li><code>time</code> support</li>
<li><code>FILE</code> and additional stdio functions</li>
</ul>
<p>We are currently not planning full support for:</p>
<ul>
<li><code>locale</code></li>
</ul>
<h2>Getting Started</h2>
<h3>Requirements</h3>
<ul>
<li><a href="https://cmocka.org">CMocka</a> must be installed on your system to compile and run unit tests</li>
<li><a href="http://www.stack.nl/~dimitri/doxygen/">Doxygen</a> must be installed to generate documentation</li>
<li><a href="#meson-build-system">Meson</a> is the build system</li>
<li><a href="https://git-lfs.github.com"><code>git-lfs</code></a> is used to store binary files in this repository</li>
<li><code>make</code> is needed if you want to use the Makefile shims</li>
<li>You'll need some kind of compiler for your target system.<ul>
<li>This repository has been tested with:<ul>
<li>gcc</li>
<li>arm-none-eabi-gcc</li>
<li>Apple clang</li>
<li>Mainline clang</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Contributors will also need:</p>
<ul>
<li><a href="https://github.com/npryce/adr-tools"><code>adr-tools</code></a> for documenting major project decisions</li>
<li><a href="https://clang.llvm.org/docs/ClangFormat.html"><code>clang-format</code></a> for code formatting</li>
</ul>
<h4>git-lfs</h4>
<p>This project stores some files using <a href="https://git-lfs.github.com"><code>git-lfs</code></a>.</p>
<p>To install <code>git-lfs</code> on Linux:</p>
<div class="fragment"><div class="line">sudo apt install git-lfs</div></div><!-- fragment --><p>To install <code>git-lfs</code> on OS X:</p>
<div class="fragment"><div class="line">brew install git-lfs</div></div><!-- fragment --><p>Additional installation instructions can be found on the <a href="https://git-lfs.github.com"><code>git-lfs</code> website</a>.</p>
<h4>Meson Build System</h4>
<p>The <a href="http://mesonbuild.com/index.html">Meson</a> build system depends on <code>python3</code> and <code>ninja-build</code>.</p>
<p>To install on Linux:</p>
<div class="fragment"><div class="line">sudo apt-get install python3 python3-pip ninja-build</div></div><!-- fragment --><p>To install on OSX:</p>
<div class="fragment"><div class="line">brew install python3 ninja</div></div><!-- fragment --><p>Meson can be installed through <code>pip3</code>:</p>
<div class="fragment"><div class="line">pip3 install meson</div></div><!-- fragment --><p>If you want to install Meson globally on Linux, use:</p>
<div class="fragment"><div class="line">sudo -H pip3 install meson</div></div><!-- fragment --><h4><code>adr-tools</code></h4>
<p>This repository uses <a href="https://embeddedartistry.com/blog/2018/4/5/documenting-architectural-decisions-within-our-repositories">Architecture Decision Records</a>. Please install <a href="https://github.com/npryce/adr-tools"><code>adr-tools</code></a> to contribute to architecture decisions.</p>
<p>If you are using OSX, you can install <code>adr-tools</code> through Homebrew:</p>
<div class="fragment"><div class="line">brew install adr-tools</div></div><!-- fragment --><p>If you are using Windows or Linux, please install <code>adr-tools</code> via <a href="https://github.com/npryce/adr-tools">GitHub</a>.</p>
<h3>Getting the Source</h3>
<p>This project uses <a href="https://git-lfs.github.com"><code>git-lfs</code></a>, so please install it before cloning. If you cloned prior to installing <code>git-lfs</code>, simply run <code>git lfs pull</code> after installation.</p>
<p>This project is <a href="https://github.com/embeddedartistry/libc">hosted on GitHub</a>. You can clone the project directly using this command:</p>
<div class="fragment"><div class="line">git clone --recursive git@github.com:embeddedartistry/libc.git</div></div><!-- fragment --><p>If you don't clone recursively, be sure to run the following command in the repository or your build will fail:</p>
<div class="fragment"><div class="line">git submodule update --init</div></div><!-- fragment --><h3>Building</h3>
<p>The library can be built by issuing the following command:</p>
<div class="fragment"><div class="line">make</div></div><!-- fragment --><p>This will build all targets for your current architecture.</p>
<p>You can clean builds using:</p>
<div class="fragment"><div class="line">make clean</div></div><!-- fragment --><p>You can eliminate the generated <code>buildresults</code> folder using:</p>
<div class="fragment"><div class="line">make purify</div></div><!-- fragment --><p>You can also use the <code>meson</code> method for compiling.</p>
<p>Create a build output folder:</p>
<div class="fragment"><div class="line">meson buildresults</div></div><!-- fragment --><p>Then change into that folder and build targets by running:</p>
<div class="fragment"><div class="line">ninja</div></div><!-- fragment --><p>At this point, <code>make</code> would still work.</p>
<h4>Cross-compiling</h4>
<p>Cross-compilation is handled using <code>meson</code> cross files. Example files are included in the <a href="build/cross/"><code>build/cross</code></a> folder. You can write your own cross files for your specific platform (or open an issue and we can help you).</p>
<p>Cross-compilation must be configured using the meson command when creating the build output folder. For example:</p>
<div class="fragment"><div class="line">meson buildresults --cross-file build/cross/gcc/arm/gcc_arm_cortex-m4.txt</div></div><!-- fragment --><p>Following that, you can run <code>make</code> (at the project root) or <code>ninja</code> (within the build output directory) to build the project.</p>
<p>Tests will not be cross-compiled. They will be built for the native platform.</p>
<h3>Installation</h3>
<p>If you don't use <code>meson</code> for your project, the best method to use this project is to build it separately and copy the headers and library contents into your source tree.</p>
<ul>
<li>Copy the <code>include/</code> directory contents into your source tree.</li>
<li>Library artifacts are stored in the <code>buildresults/src</code> folder</li>
<li>Copy the desired library to your project and add the library to your link step.</li>
</ul>
<p>Example linker flags:</p>
<div class="fragment"><div class="line">-Lpath/to/libc.a -lc </div></div><!-- fragment --><p>If you're using <code>meson</code>, you can use <code>libc</code> as a subproject. Place it into your subproject directory of choice and add a <code>subproject</code> statement:</p>
<div class="fragment"><div class="line">libc = subproject(&#39;libc&#39;)</div></div><!-- fragment --><p>You will need to promote the subproject dependencies to your project:</p>
<div class="fragment"><div class="line">libc_dep = libc.get_variable(&#39;libc_dep&#39;)</div><div class="line">libc_native_dep = libc.get_variable(&#39;libc_native_dep&#39;)</div><div class="line">libc_hosted_dep = libc.get_variable(&#39;libc_hosted_dep&#39;)</div><div class="line">libc_printf_dep = libc.get_variable(&#39;libc_printf_dep&#39;)</div><div class="line">libc_header_include = libc.get_variable(&#39;libc_header_include&#39;)</div><div class="line">libc_native_header_include = libc.get_variable(&#39;libc_native_header_include&#39;)</div></div><!-- fragment --><p>You can use the dependency for your target library configuration in your <code>executable</code> declarations(s) or other dependencies. For example:</p>
<div class="fragment"><div class="line">fwdemo_sim_platform_dep = declare_dependency(</div><div class="line">    include_directories: fwdemo_sim_platform_inc,</div><div class="line">    dependencies: [</div><div class="line">        fwdemo_simulator_hw_platform_dep,</div><div class="line">        posix_os_dep,</div><div class="line">        libmemory_native_dep,</div><div class="line">        libc_native_dep, # &lt;----- libc added here</div><div class="line">        libcxxabi_native_dep,</div><div class="line">        libcxx_full_native_dep,</div><div class="line">        logging_subsystem_dep</div><div class="line">    ],</div><div class="line">    sources: files(&#39;platform.cpp&#39;),</div><div class="line">)</div></div><!-- fragment --><h3>Testing</h3>
<p>The tests for this library are written with <a href="https://cmocka.org">CMocka</a>. You can run the tests by issuing the following command:</p>
<div class="fragment"><div class="line">make test</div></div><!-- fragment --><p>By default, test results are generated for use by the CI server and are formatted in JUnit XML. The test results XML files can be found in <code>buildresults/test/</code>.</p>
<h2>Configuration Options</h2>
<p>The following meson project options can be set for this library when creating the build results directory with <code>meson</code>, or by using <code>meson configure</code>:</p>
<ul>
<li><code>enable-werror</code>: Cause the build to fail if warnings are present</li>
<li><code>enable-pedantic-error</code>: Turn on <code>pedantic</code> warnings and errors</li>
<li><code>hide-unimplemented-libc-apis</code>: Hides the header definitions for functions which are not actually implemented</li>
</ul>
<p>Options can be specified using <code>-D</code> and the option name:</p>
<div class="fragment"><div class="line">meson buildresults -Denable-werror=true</div></div><!-- fragment --><p>The same style works with <code>meson configure</code>:</p>
<div class="fragment"><div class="line">cd buildresults</div><div class="line">meson configure -Denable-werror=true</div></div><!-- fragment --><h2>Formatting</h2>
<p>This repository enforces formatting using <a href="https://clang.llvm.org/docs/ClangFormat.html"><code>clang-format</code></a>.</p>
<p>You can auto-format your code to match the style guidelines by issuing the following command:</p>
<div class="fragment"><div class="line">make format</div></div><!-- fragment --><p>Formatting is enforced by the Jenkins build server which runs continuous integration for this project. Your pull request will not be accepted if the formatting check fails.</p>
<h2>Documentation</h2>
<p><a href="https://embeddedartistry.github.io/libc/index.html">Documentation for the latest release can always be found here</a>.</p>
<p>Documentation can be built locally by running the following command:</p>
<div class="fragment"><div class="line">make docs</div></div><!-- fragment --><p>Documentation can be found in <code>buildresults/doc</code>, and the root page is <code>index.html</code>.</p>
<h2>Need help?</h2>
<p>If you need further assistance or have any questions, please <a href="https://github.com/embeddedartistry/libc/issues/new">file a GitHub Issue</a> or send us an email using the <a href="http://embeddedartistry.com/contact">Embedded Artistry Contact Form</a>.</p>
<p>You can also <a href="https://twitter.com/mbeddedartistry/">reach out on Twitter: mbeddedartistry</a>.</p>
<h2>Contributing</h2>
<p>If you are interested in contributing to this project, please read our <a class="el" href="d5/d69/md_docs__c_o_n_t_r_i_b_u_t_i_n_g.html">contributing guidelines</a>.</p>
<h2>Further Reading</h2>
<ul>
<li><a href="https://embeddedartistry.github.io/libc/index.html"><code>libc</code> Documentation</a></li>
<li><a class="el" href="d5/d69/md_docs__c_o_n_t_r_i_b_u_t_i_n_g.html">`CONTRIBUTING` Guide</a></li>
</ul>
<h2>Authors</h2>
<ul>
<li><b><a href="https://github.com/phillipjohnston">Phillip Johnston</a></b> - original library author - <a href="https://github.com/embeddedartistry">Embedded Artistry</a></li>
</ul>
<h2>License</h2>
<p>Copyright Â© 2017 Embedded Artistry LLC</p>
<p>This project is licensed under the MIT License - see [LICENSE](LICENSE) file for details.</p>
<p>For other open-source licenses, please see the <a href="docs/software_inventory.xlsx">Software Inventory</a>.</p>
<h2>Acknowledgments</h2>
<p>I'd like to thank the following individuals for their direct contributions on this project:</p>
<ul>
<li><a href="https://github.com/seekaddo">@seekaddo</a> (Documentation)</li>
</ul>
<p>Many of the open-source function implementations used in this library have been pulled from two primary sources:</p>
<ul>
<li><a href="https://opensource.apple.com/source/Libc/">Apple Open Source libc</a><ul>
<li>abs, atof, bsearch, div family, heapsort/qsort family, abs family, imax family, strtol/ll/ull</li>
<li>fls, flsl, flsll</li>
<li>strstr, strtok. strnstr, strnlen, strndup, strncpy, strncat, strlen, strdup, strcpy, strcat</li>
<li>memmem, memcpy</li>
</ul>
</li>
<li><a href="https://www.musl-libc.org">musl libc</a><ul>
<li>All ctype member functions (locale support removed)</li>
<li>strrchr, strchrnul, strchr</li>
<li>memset, memrchr</li>
</ul>
</li>
</ul>
<p>I have also used and improved the open-source <code>gdtoa</code> library.</p>
<p>The initial groundwork of testing was implemented by referencing the <a href="http://nsz.repo.hu/git/?p=libc-test">libc-test</a> project.</p>
<p><b><a href="#table-of-contents">Back to top</a></b> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
