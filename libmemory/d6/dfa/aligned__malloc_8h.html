<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded Artistry libmemory: include/aligned_malloc.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded Artistry libmemory
   </div>
   <div id="projectbrief">Memory library for embedded systems (malloc and friends)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d6/dfa/aligned__malloc_8h.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">aligned_malloc.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stddef.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for aligned_malloc.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../d6/d6b/aligned__malloc_8h__incl.png" border="0" usemap="#include_2aligned__malloc_8h" alt=""/></div>
<map name="include_2aligned__malloc_8h" id="include_2aligned__malloc_8h">
<area shape="rect"  title=" " alt="" coords="5,5,173,31"/>
<area shape="rect"  title=" " alt="" coords="55,79,123,104"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/dcd/aligned__malloc_8h__dep__incl.png" border="0" usemap="#include_2aligned__malloc_8hdep" alt=""/></div>
<map name="include_2aligned__malloc_8hdep" id="include_2aligned__malloc_8hdep">
<area shape="rect"  title=" " alt="" coords="77,5,244,31"/>
<area shape="rect"  href="../../d3/dde/aligned__malloc_8c.html" title=" " alt="" coords="5,79,147,104"/>
<area shape="rect"  href="../../d7/d69/posix__memalign_8c.html" title=" " alt="" coords="171,79,320,104"/>
</map>
</div>
</div>
<p><a href="../../d6/dfa/aligned__malloc_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad3cb0af0afe3f554732e296d29b6d4ea"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfa/aligned__malloc_8h.html#ad3cb0af0afe3f554732e296d29b6d4ea">memalign</a>(align,  size)&#160;&#160;&#160;<a class="el" href="../../d3/dde/aligned__malloc_8c.html#af9d29fa5731420020b36ffbf56e6de97">aligned_malloc</a>(align, size)</td></tr>
<tr class="memdesc:ad3cb0af0afe3f554732e296d29b6d4ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">A convenience macro for the Linux API.  <a href="#ad3cb0af0afe3f554732e296d29b6d4ea">More...</a><br /></td></tr>
<tr class="separator:ad3cb0af0afe3f554732e296d29b6d4ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af9d29fa5731420020b36ffbf56e6de97"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfa/aligned__malloc_8h.html#af9d29fa5731420020b36ffbf56e6de97">aligned_malloc</a> (size_t align, size_t size)</td></tr>
<tr class="memdesc:af9d29fa5731420020b36ffbf56e6de97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocated aligned memory.  <a href="#af9d29fa5731420020b36ffbf56e6de97">More...</a><br /></td></tr>
<tr class="separator:af9d29fa5731420020b36ffbf56e6de97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed1e9c27ea92f5ae3a480059bf45c311"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfa/aligned__malloc_8h.html#aed1e9c27ea92f5ae3a480059bf45c311">posix_memalign</a> (void **memptr, size_t alignment, size_t size)</td></tr>
<tr class="separator:aed1e9c27ea92f5ae3a480059bf45c311"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a274dd8714485eed9c9328973d44ec5dc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfa/aligned__malloc_8h.html#a274dd8714485eed9c9328973d44ec5dc">aligned_free</a> (void *ptr)</td></tr>
<tr class="memdesc:a274dd8714485eed9c9328973d44ec5dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free aligned memory.  <a href="#a274dd8714485eed9c9328973d44ec5dc">More...</a><br /></td></tr>
<tr class="separator:a274dd8714485eed9c9328973d44ec5dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad3cb0af0afe3f554732e296d29b6d4ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3cb0af0afe3f554732e296d29b6d4ea">&#9670;&nbsp;</a></span>memalign</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define memalign</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">align, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">size&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="../../d3/dde/aligned__malloc_8c.html#af9d29fa5731420020b36ffbf56e6de97">aligned_malloc</a>(align, size)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A convenience macro for the Linux API. </p>
<p><a class="el" href="../../d6/dfa/aligned__malloc_8h.html#ad3cb0af0afe3f554732e296d29b6d4ea" title="A convenience macro for the Linux API.">memalign()</a> is simply a convenience definition which provides the commonly-used Linux API memalign. This forwards the arguments to <a class="el" href="../../d6/dfa/aligned__malloc_8h.html#af9d29fa5731420020b36ffbf56e6de97" title="Allocated aligned memory.">aligned_malloc()</a> and behaves in the same manner.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">align</td><td>Alignment of the memory block. Alignment refers to the starting address of the memory block. If 32-byte alignment is requested, the start address of the returned pointer will be 32-byte aligned. Note: Alignment must be a power of two. (1, 2, 4, 8, etc.)</td></tr>
    <tr><td class="paramname">size</td><td>Size of the memory allocation</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to allocated memory. If memory was not successfully allocated, the function will return NULL. This can happen due to invalid input (alignment is 0, size is 0, alignment is not a power of 2) or due to insufficient memory left for the requested allocation. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/dfa/aligned__malloc_8h_source.html#l00057">57</a> of file <a class="el" href="../../d6/dfa/aligned__malloc_8h_source.html">aligned_malloc.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a274dd8714485eed9c9328973d44ec5dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a274dd8714485eed9c9328973d44ec5dc">&#9670;&nbsp;</a></span>aligned_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void aligned_free </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free aligned memory. </p>
<p>Free memory that was allocated using <a class="el" href="../../d3/dde/aligned__malloc_8c.html#af9d29fa5731420020b36ffbf56e6de97" title="Allocated aligned memory.">aligned_malloc()</a>. This function <em>must not</em> be called on memory which was not allocated with <a class="el" href="../../d3/dde/aligned__malloc_8c.html#af9d29fa5731420020b36ffbf56e6de97" title="Allocated aligned memory.">aligned_malloc()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr</td><td>Pointer to the aligned_memory() block that will be freed.</td></tr>
  </table>
  </dd>
</dl>
<p>aligned_free works like <a class="el" href="../../df/dbe/malloc__freelist_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free()</a>, but we work backwards from the returned pointer to find the correct offset and pointer location to return to <a class="el" href="../../df/dbe/malloc__freelist_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free()</a> Note that it is VERY BAD to call <a class="el" href="../../df/dbe/malloc__freelist_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free()</a> on an <a class="el" href="../../d3/dde/aligned__malloc_8c.html#af9d29fa5731420020b36ffbf56e6de97" title="Allocated aligned memory.">aligned_malloc()</a> pointer. </p>

<p class="definition">Definition at line <a class="el" href="../../d3/dde/aligned__malloc_8c_source.html#l00074">74</a> of file <a class="el" href="../../d3/dde/aligned__malloc_8c_source.html">aligned_malloc.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;{</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    assert(ptr);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">     * Walk backwards from the passed-in pointer to get the pointer offset</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">     * We convert to an offset_t pointer and rely on pointer math to get the data</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="../../d3/dde/aligned__malloc_8c.html#a310df0c401bac7455ba4512bf170044a">offset_t</a> offset = *((<a class="code" href="../../d3/dde/aligned__malloc_8c.html#a310df0c401bac7455ba4512bf170044a">offset_t</a>*)ptr - 1);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">     * Once we have the offset, we can get our original pointer and call free</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">void</span>* p = (<span class="keywordtype">void</span>*)((uint8_t*)ptr - offset);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="../../df/dbe/malloc__freelist_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a>(p);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;}</div><div class="ttc" id="malloc__freelist_8c_html_afbedc913aa4651b3c3b4b3aecd9b4711"><div class="ttname"><a href="../../df/dbe/malloc__freelist_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a></div><div class="ttdeci">void free(void *ptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dbe/malloc__freelist_8c_source.html#l00126">malloc_freelist.c:126</a></div></div>
<div class="ttc" id="aligned__malloc_8c_html_a310df0c401bac7455ba4512bf170044a"><div class="ttname"><a href="../../d3/dde/aligned__malloc_8c.html#a310df0c401bac7455ba4512bf170044a">offset_t</a></div><div class="ttdeci">uint16_t offset_t</div><div class="ttdoc">Number of bytes we're using for storing the aligned pointer offset.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dde/aligned__malloc_8c_source.html#l00025">aligned_malloc.c:25</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../df/dbe/malloc__freelist_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free()</a>.</p>

</div>
</div>
<a id="af9d29fa5731420020b36ffbf56e6de97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9d29fa5731420020b36ffbf56e6de97">&#9670;&nbsp;</a></span>aligned_malloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* aligned_malloc </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>align</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocated aligned memory. </p>
<p>Allocate memory with at least alignment <code>align</code> and size <code>size</code> Memory which has been allocated with <a class="el" href="../../d3/dde/aligned__malloc_8c.html#af9d29fa5731420020b36ffbf56e6de97" title="Allocated aligned memory.">aligned_malloc()</a> must be freed by calling <a class="el" href="../../d3/dde/aligned__malloc_8c.html#a274dd8714485eed9c9328973d44ec5dc" title="Free aligned memory.">aligned_free()</a>. Calling <a class="el" href="../../df/dbe/malloc__freelist_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free()</a> will result in a panic or other negative effects.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">align</td><td>Alignment of the memory block. Alignment refers to the starting address of the memory block. If 32-byte alignment is requested, the start address of the returned pointer will be 32-byte aligned. Note: Alignment must be a power of two. (1, 2, 4, 8, etc.)</td></tr>
    <tr><td class="paramname">size</td><td>Size of the memory allocation</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to allocated memory. If memory was not successfully allocated, the function will return NULL. This can happen due to invalid input (alignment is 0, size is 0, alignment is not a power of 2) or due to insufficient memory left for the requested allocation.</dd></dl>
<p>We will call malloc with extra bytes for our header and the offset required to guarantee the desired alignment. </p>

<p class="definition">Definition at line <a class="el" href="../../d3/dde/aligned__malloc_8c_source.html#l00036">36</a> of file <a class="el" href="../../d3/dde/aligned__malloc_8c_source.html">aligned_malloc.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordtype">void</span>* ptr = NULL;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// We want it to be a power of two since align_up operates on powers of two</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    assert((align &amp; (align - 1)) == 0);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">if</span>(align &amp;&amp; size)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">         * We know we have to fit an offset value</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">         * We also allocate extra bytes to ensure we can meet the alignment</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keywordtype">size_t</span> hdr_size = <a class="code" href="../../d3/dde/aligned__malloc_8c.html#ae270c0b6ce92c0334142b6ac81ea047d">PTR_OFFSET_SZ</a> + (align - 1);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordtype">void</span>* p = <a class="code" href="../../df/dbe/malloc__freelist_8c.html#a7ac38fce3243a7dcf448301ee9ffd392">malloc</a>(size + hdr_size);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keywordflow">if</span>(p)</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">             * Add the offset size to malloc&#39;s pointer (we will always store that)</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">             * Then align the resulting value to the arget alignment</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            ptr = (<span class="keywordtype">void</span>*)<a class="code" href="../../d3/dde/aligned__malloc_8c.html#ad7cedda95a9788a1df13133fabd15ce5">align_up</a>(((uintptr_t)p + <a class="code" href="../../d3/dde/aligned__malloc_8c.html#ae270c0b6ce92c0334142b6ac81ea047d">PTR_OFFSET_SZ</a>), align);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            <span class="comment">// Calculate the offset and store it behind our aligned pointer</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            *((<a class="code" href="../../d3/dde/aligned__malloc_8c.html#a310df0c401bac7455ba4512bf170044a">offset_t</a>*)ptr - 1) = (<a class="code" href="../../d3/dde/aligned__malloc_8c.html#a310df0c401bac7455ba4512bf170044a">offset_t</a>)((uintptr_t)ptr - (uintptr_t)p);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        } <span class="comment">// else NULL, could not malloc</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    } <span class="comment">// else NULL, invalid arguments</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">return</span> ptr;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div><div class="ttc" id="aligned__malloc_8c_html_a310df0c401bac7455ba4512bf170044a"><div class="ttname"><a href="../../d3/dde/aligned__malloc_8c.html#a310df0c401bac7455ba4512bf170044a">offset_t</a></div><div class="ttdeci">uint16_t offset_t</div><div class="ttdoc">Number of bytes we're using for storing the aligned pointer offset.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dde/aligned__malloc_8c_source.html#l00025">aligned_malloc.c:25</a></div></div>
<div class="ttc" id="aligned__malloc_8c_html_ae270c0b6ce92c0334142b6ac81ea047d"><div class="ttname"><a href="../../d3/dde/aligned__malloc_8c.html#ae270c0b6ce92c0334142b6ac81ea047d">PTR_OFFSET_SZ</a></div><div class="ttdeci">#define PTR_OFFSET_SZ</div><div class="ttdoc">Macro for accessing the size of our current pointer offset.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dde/aligned__malloc_8c_source.html#l00028">aligned_malloc.c:28</a></div></div>
<div class="ttc" id="aligned__malloc_8c_html_ad7cedda95a9788a1df13133fabd15ce5"><div class="ttname"><a href="../../d3/dde/aligned__malloc_8c.html#ad7cedda95a9788a1df13133fabd15ce5">align_up</a></div><div class="ttdeci">#define align_up(num, align)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dde/aligned__malloc_8c_source.html#l00021">aligned_malloc.c:21</a></div></div>
<div class="ttc" id="malloc__freelist_8c_html_a7ac38fce3243a7dcf448301ee9ffd392"><div class="ttname"><a href="../../df/dbe/malloc__freelist_8c.html#a7ac38fce3243a7dcf448301ee9ffd392">malloc</a></div><div class="ttdeci">void * malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dbe/malloc__freelist_8c_source.html#l00085">malloc_freelist.c:85</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d3/dde/aligned__malloc_8c.html#ad7cedda95a9788a1df13133fabd15ce5">align_up</a>, <a class="el" href="../../df/dbe/malloc__freelist_8c.html#a7ac38fce3243a7dcf448301ee9ffd392">malloc()</a>, and <a class="el" href="../../d3/dde/aligned__malloc_8c.html#ae270c0b6ce92c0334142b6ac81ea047d">PTR_OFFSET_SZ</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d7/d69/posix__memalign_8c.html#a120e64e22bc82d4930f98147eee3e85f">posix_memalign()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d6/dfa/aligned__malloc_8h_af9d29fa5731420020b36ffbf56e6de97_icgraph.png" border="0" usemap="#d6/dfa/aligned__malloc_8h_af9d29fa5731420020b36ffbf56e6de97_icgraph" alt=""/></div>
<map name="d6/dfa/aligned__malloc_8h_af9d29fa5731420020b36ffbf56e6de97_icgraph" id="d6/dfa/aligned__malloc_8h_af9d29fa5731420020b36ffbf56e6de97_icgraph">
<area shape="rect"  title="Allocated aligned memory." alt="" coords="171,5,281,31"/>
<area shape="rect"  href="../../d7/d69/posix__memalign_8c.html#a120e64e22bc82d4930f98147eee3e85f" title=" " alt="" coords="5,5,123,31"/>
</map>
</div>

</div>
</div>
<a id="aed1e9c27ea92f5ae3a480059bf45c311"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed1e9c27ea92f5ae3a480059bf45c311">&#9670;&nbsp;</a></span>posix_memalign()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int posix_memalign </td>
          <td>(</td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>memptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>alignment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Posix Memory Alignment Extension</p>
<p>Generated aligned memory. This function forwards the request to aligned malloc. Allocated memory must be freed with <a class="el" href="../../d6/dfa/aligned__malloc_8h.html#a274dd8714485eed9c9328973d44ec5dc" title="Free aligned memory.">aligned_free()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">memptr</td><td>A pointer to the pointer which will store the aligned memory. The memory must be freed with <a class="el" href="../../d6/dfa/aligned__malloc_8h.html#a274dd8714485eed9c9328973d44ec5dc" title="Free aligned memory.">aligned_free()</a>. memptr must not be NULL. </td></tr>
    <tr><td class="paramname">alignment</td><td>The target alignment for the memory. Must be a power of 2. </td></tr>
    <tr><td class="paramname">size</td><td>The size of the allocation. Must be &gt; 0.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section pre"><dt>Precondition</dt><dd><code>memptr</code> is not NULL. <code>alignment</code> is power-of-2. <code>size</code> &gt; 0.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ENOMEM if memory could not be allocated, EINVAL if alignment is not a power-of-2, and 0 on successful allocation. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d7/d69/posix__memalign_8c_source.html#l00007">7</a> of file <a class="el" href="../../d7/d69/posix__memalign_8c_source.html">posix_memalign.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <span class="keywordtype">int</span> r = ENOMEM;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    assert(__memptr);</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    assert(__size &gt; 0);</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="comment">// TODO: Do we need to check if __alignment is a multiple of sizeof(void *)?</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="../../d7/d69/posix__memalign_8c.html#afde7f480bb136d95a4da3bdf0c616442">IS_POWER_2</a>(__alignment))</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    {</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        r = EINVAL;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    {</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        *__memptr = <a class="code" href="../../d6/dfa/aligned__malloc_8h.html#af9d29fa5731420020b36ffbf56e6de97">aligned_malloc</a>(__alignment, __size);</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="keywordflow">if</span>(*__memptr != NULL)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;            r = 0;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        }</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    }</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">return</span> r;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;}</div><div class="ttc" id="aligned__malloc_8h_html_af9d29fa5731420020b36ffbf56e6de97"><div class="ttname"><a href="../../d6/dfa/aligned__malloc_8h.html#af9d29fa5731420020b36ffbf56e6de97">aligned_malloc</a></div><div class="ttdeci">void * aligned_malloc(size_t align, size_t size)</div><div class="ttdoc">Allocated aligned memory.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dde/aligned__malloc_8c_source.html#l00036">aligned_malloc.c:36</a></div></div>
<div class="ttc" id="posix__memalign_8c_html_afde7f480bb136d95a4da3bdf0c616442"><div class="ttname"><a href="../../d7/d69/posix__memalign_8c.html#afde7f480bb136d95a4da3bdf0c616442">IS_POWER_2</a></div><div class="ttdeci">#define IS_POWER_2(x)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/posix__memalign_8c_source.html#l00005">posix_memalign.c:5</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/dfa/aligned__malloc_8h.html#af9d29fa5731420020b36ffbf56e6de97">aligned_malloc()</a>, and <a class="el" href="../../d7/d69/posix__memalign_8c.html#afde7f480bb136d95a4da3bdf0c616442">IS_POWER_2</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../d6/dfa/aligned__malloc_8h.html">aligned_malloc.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
